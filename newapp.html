<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Presenze Cantiere</title>

  <style>
    /* =================== RESET & THEME =================== */
    *{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent}
    :root{
      --primary:#FF6B35; --primary-dark:#E55A2B;
      --secondary:#004E89; --secondary-light:#1A659E;
      --accent:#F7B801; --success:#06D6A0; --danger:#dc2626;
      --bg:#0A0E27; --bg-light:#1a1f3a;
      --card-bg:rgba(255,255,255,.05); --border:rgba(255,255,255,.1);
      --text:#fff; --text-secondary:#B8C5D6;
      --zoom:1;
      --morning-grad: linear-gradient(135deg,#4da3ff,#5bc0eb);
      --afternoon-grad: linear-gradient(135deg,var(--primary),var(--accent));
      --slot-h: 196px;
      --radius: 20px;
    }
    body{
      font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;
      background:var(--bg); color:var(--text);
      overflow-x:hidden; min-height:100vh; position:relative;
      padding-bottom: env(safe-area-inset-bottom, 0);
      touch-action: manipulation;
    }
    body::before{
      content:''; position:fixed; top:-50%; left:-50%; width:200%; height:200%;
      background:
        radial-gradient(circle at 20% 50%,rgba(255,107,53,.15)0%,transparent 50%),
        radial-gradient(circle at 80% 80%,rgba(0,78,137,.15)0%,transparent 50%),
        radial-gradient(circle at 40% 20%,rgba(247,184,1,.1)0%,transparent 50%);
      animation:drift 20s ease-in-out infinite; z-index:0;
    }
    @keyframes drift{ 0%,100%{transform:translate(0,0) rotate(0)} 33%{transform:translate(30px,-30px) rotate(5deg)} 66%{transform:translate(-20px,20px) rotate(-5deg)} }
    .container{
      display: none; /* Nascosto di default, mostrato da JS dopo il login */
      position:relative; z-index:1; max-width:480px; margin:0 auto; min-height:100vh;
      transform: scale(var(--zoom)); transform-origin: top center;
      width: calc(100vw / var(--zoom)); min-height: calc(100vh / var(--zoom));
      will-change: transform,width;
    }
    .header{ background:linear-gradient(135deg,var(--primary) 0%,var(--primary-dark) 100%); padding:60px 24px 40px; border-radius:0 0 32px 32px; box-shadow:0 10px 40px rgba(255,107,53,.3); position:relative; overflow:hidden; }
    .header::before{content:''; position:absolute; top:-50%; right:-20%; width:200px; height:200px; background:rgba(255,255,255,.1); border-radius:50%; animation:float 6s ease-in-out infinite}
    @keyframes float{0%,100%{transform:translateY(0) scale(1)}50%{transform:translateY(-20px) scale(1.1)}}
    .header h1{font-size:28px; font-weight:800; margin-bottom:8px}
    .header .subtitle{color:rgba(255,255,255,.9); font-size:16px; font-weight:500}
    .user-info { display: flex; align-items: center; justify-content: space-between; margin-top: 16px; }
    .user-badge{display:inline-flex; align-items:center; gap:8px; background:rgba(255,255,255,.2); backdrop-filter:blur(10px); padding:8px 16px; border-radius:20px; font-size:14px; font-weight:600}
    #logoutBtn { background: rgba(220, 38, 38, 0.5); border: 1px solid var(--danger); color: white; padding: 8px 16px; border-radius: 20px; cursor: pointer; font-weight: 600; font-size: 14px; transition: .2s; }
    #logoutBtn:hover { background: var(--danger); transform: scale(1.05); }
    .content{padding:24px}
    /* ... il resto del tuo CSS rimane esattamente lo stesso ... */
  </style>
</head>
<body>
  <!-- Il container principale dell'app. Inizialmente è nascosto. -->
  <div class="container" id="appContainer">
    <!-- ===== HEADER ===== -->
    <div class="header">
      <h1>⚡ Presenze Cantiere</h1>
      <p class="subtitle">Registra la tua giornata lavorativa</p>
      <div class="user-info">
        <div class="user-badge"><span>👷</span><span id="userName">Caricamento...</span></div>
        <button id="logoutBtn">Logout</button>
      </div>
    </div>

    <div class="content">
      <!-- Progress bar a step -->
      <div class="step-indicator"><div class="step active"></div><div class="step"></div><div class="step"></div><div class="step"></div></div>

      <!-- ===== Pagina 1: Seleziona data + Lista mese (toggle) ===== -->
      <div class="page active" id="page1">
        <div class="card">
          <div class="card-title"><span class="icon">📅</span><span>Seleziona la data</span></div>
          <div class="date-selector" id="dateSelector"></div>
        </div>
        <div class="card">
          <div class="month-toggle" id="monthToggle">
            <span id="monthTitle">📆 Presenze del mese</span>
            <strong id="monthToggleArrow">▼</strong>
          </div>
          <div id="monthList" class="month-list"></div>
        </div>
        <div class="btn-group">
          <button class="btn" onclick="nextPage(2)">Avanti <span>→</span></button>
        </div>
      </div>

      <!-- ===== Pagina 2: Orari di lavoro ===== -->
      <div class="page" id="page2">
        <div class="card">
          <div class="card-title"><span class="icon">⏰</span><span>Orario di lavoro</span></div>
          <div class="time-picker">
            <div class="time-slot morning">
              <div class="slot-bg"></div>
              <div class="slot-inner">
                <div class="slot-head"><span class="icon">☀️</span><div class="label">Mattina</div></div>
                <div class="slot-time" id="morningText">08:00 - 12:00</div>
                <div class="time-inputs">
                  <input type="time" id="mStart" value="08:00" min="07:00" max="15:00" step="1800" oninput="updateTimes()">
                  <input type="time" id="mEnd"   value="12:00" min="07:00" max="15:00" step="1800" oninput="updateTimes()">
                </div>
              </div>
            </div>
            <div class="time-slot afternoon">
              <div class="slot-bg"></div>
              <div class="slot-inner">
                <div class="slot-head"><span class="icon">🌙</span><div class="label">Pomeriggio</div></div>
                <div class="slot-time" id="afternoonText">13:00 - 17:00</div>
                <div class="time-inputs">
                  <input type="time" id="pStart" value="13:00" min="12:00" max="20:00" step="1800" oninput="updateTimes()">
                  <input type="time" id="pEnd"   value="17:00" min="12:00" max="20:00" step="1800" oninput="updateTimes()">
                </div>
              </div>
            </div>
          </div>
          <div style="margin-top:16px;padding:16px;background:var(--bg-light);border-radius:16px;text-align:center;">
            <div style="color:var(--text-secondary);font-size:14px;margin-bottom:4px;">Ore totali</div>
            <div style="font-size:32px;font-weight:800;color:var(--accent);" id="totalHours">8.0h</div>
          </div>
        </div>
        <div class="btn-group">
          <button class="btn btn-secondary" onclick="prevPage(1)"><span>←</span>Indietro</button>
          <button class="btn" onclick="nextPage(3)">Avanti <span>→</span></button>
        </div>
      </div>

      <!-- ===== Pagina 3: Cantieri multipli (max 3) ===== -->
      <div class="page" id="page3">
        <div class="card">
          <div class="card-title"><span class="icon">🏗️</span><span>Cantieri</span></div>
          <div id="workItems"></div>
          <button class="add-work-btn" id="addWorkBtn" onclick="addWorkItem()">+ Aggiungi cantiere (max 3)</button>
        </div>
        <div class="btn-group">
          <button class="btn btn-secondary" onclick="prevPage(2)"><span>←</span>Indietro</button>
          <button class="btn" onclick="nextPage(4)">Avanti <span>→</span></button>
        </div>
      </div>

      <!-- ===== Pagina 4: Riepilogo + Note ===== -->
      <div class="page" id="page4">
        <div class="card">
          <div class="card-title"><span class="icon">🗒️</span><span>Note</span></div>
          <div class="input-group">
            <span class="input-icon">✏️</span>
            <textarea id="notesInput" placeholder="Aggiungi eventuali note (facoltative)..." oninput="updateSummary()"></textarea>
          </div>
        </div>
        <div class="card summary-card">
          <div class="card-title" style="color:#fff;margin-bottom:20px;"><span class="icon">📋</span><span>Riepilogo</span></div>
          <div class="summary-row"><span class="summary-label">Data</span><span class="summary-value" id="summaryDate">Oggi</span></div>
          <div class="summary-row"><span class="summary-label">Orario</span><span class="summary-value" id="summaryTime">08:00 - 17:00</span></div>
          <div style="margin-top:10px"></div>
          <div class="summary-row" style="border:none;display:block;padding-top:0;">
            <div class="summary-label" style="margin-bottom:8px">Cantieri & lavorazioni</div>
            <div class="summary-works" id="summaryWorks"></div>
          </div>
          <div class="summary-row"><span class="summary-label">Note</span><span class="summary-value" id="summaryNotes">-</span></div>
          <div class="summary-row"><span class="summary-label">Ore totali</span><span class="summary-value" style="color:var(--accent);" id="summaryHours">8.0h</span></div>
        </div>
        <div class="btn-group">
          <button class="btn btn-secondary" onclick="prevPage(3)"><span>←</span>Indietro</button>
          <button class="btn btn-success" onclick="submitPresence()"><span>✓</span>Conferma</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Modale successo -->
  <div class="success-overlay" id="successOverlay">
    <div class="success-content">
      <div class="success-icon">✨</div>
      <div class="success-title">Presenza registrata!</div>
      <div class="success-message">La tua giornata è stata salvata con successo</div>
    </div>
  </div>

  <!-- Tutto il Javascript è stato spostato in main.js -->
  <script type="module" src="main.js"></script>
</body>
</html>

