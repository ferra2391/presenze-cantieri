<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" />
<title>Presenze Cantiere</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800;900&display=swap');
  
  *{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent}
  :root{
    --primary:#FF6B35; --primary-dark:#E55A2B;
    --secondary:#6366f1; --secondary-light:#818cf8;
    --accent:#fbbf24; --success:#10b981;
    --danger:#ef4444; --muted:#94a3b8;
    --bg:#0f172a; --bg-light:#1e293b;
    --card-bg:rgba(255,255,255,.08); --border:rgba(255,255,255,.15);
    --text:#fff; --text-secondary:#cbd5e1;
  }
  
  @keyframes gradientShift {
    0%, 100% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
  }
  
  @keyframes float {
    0%, 100% { transform: translateY(0px); }
    50% { transform: translateY(-10px); }
  }
  
  body{
    font-family:'Inter',-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;
    background: linear-gradient(135deg, #0f172a 0%, #1e293b 50%, #0f172a 100%);
    background-size: 200% 200%;
    animation: gradientShift 15s ease infinite;
    color:var(--text);
    min-height:100vh;
    position:relative;
    overflow-x:hidden;
  }
  
  body::before {
    content: '';
    position: fixed;
    top: -50%;
    left: -50%;
    width: 200%;
    height: 200%;
    background: radial-gradient(circle, rgba(99, 102, 241, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 80%, rgba(255, 107, 53, 0.1) 0%, transparent 50%);
    animation: float 20s ease-in-out infinite;
    pointer-events: none;
    z-index: 0;
  }
  
  .container{position:relative;z-index:1;max-width:480px;margin:0 auto;min-height:100vh}

  /* Header */
  .header{
    background:linear-gradient(135deg,var(--primary) 0%,#c026d3 50%,var(--secondary) 100%);
    padding:20px 16px;
    border-radius:0 0 24px 24px;
    box-shadow:0 10px 50px rgba(255,107,53,.4);
    position:relative;
  }
  .header h1{
    font-size:22px;
    font-weight:900;
    letter-spacing:.5px;
    text-shadow: 2px 2px 8px rgba(0,0,0,.3);
  }
  .user-badge{
    display:inline-flex;
    align-items:center;
    gap:8px;
    background:rgba(255,255,255,.25);
    backdrop-filter:blur(20px);
    padding:6px 12px;
    border-radius:20px;
    margin-top:10px;
    font-size:13px;
    font-weight:700;
    border:1px solid rgba(255,255,255,.3);
    box-shadow:0 4px 15px rgba(0,0,0,.2);
    transition:all .3s ease;
  }
  .user-badge:hover { transform: scale(1.05); background:rgba(255,255,255,.35); }

  .content{padding:20px 16px 20px}
  .topbar{display:flex;justify-content:flex-end;padding:12px 16px}
  .logout-btn{
    background:var(--card-bg);
    backdrop-filter:blur(20px);
    border:1px solid var(--border);
    color:#fff;
    border-radius:12px;
    padding:8px 14px;
    cursor:pointer;
    font-weight:700;
    font-size:13px;
    transition:all .3s ease;
    box-shadow:0 4px 15px rgba(0,0,0,.2);
  }
  .logout-btn:hover {
    transform: translateY(-2px);
    box-shadow:0 6px 20px rgba(0,0,0,.3);
    border-color:var(--danger);
    background:rgba(239,68,68,.2);
  }

  .step-indicator{display:flex;gap:8px;margin:12px 0 16px}
  .step{
    flex:1;height:5px;background:var(--card-bg);border-radius:10px;position:relative;overflow:hidden;transition:all .4s ease;
  }
  .step.active{
    background:linear-gradient(90deg,var(--primary),var(--accent),var(--secondary));
    background-size:200% 100%;
    animation: gradientShift 3s ease infinite;
    box-shadow:0 2px 10px rgba(255,107,53,.5);
  }

  .view{display:none}
  .view.active{display:block;animation:fadeIn .4s ease}
  @keyframes fadeIn{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}

  .card{
    background:var(--card-bg);backdrop-filter:blur(30px);border:1px solid var(--border);
    border-radius:20px;padding:18px;margin-bottom:14px;
    box-shadow:0 8px 32px rgba(0,0,0,.3), inset 0 1px 0 rgba(255,255,255,.1);
    transition:all .3s ease;position:relative;
  }
  .card:hover { transform: translateY(-2px); box-shadow:0 12px 40px rgba(0,0,0,.4), inset 0 1px 0 rgba(255,255,255,.15); border-color:rgba(255,255,255,.25); }
  .card-title{font-size:15px;font-weight:800;margin-bottom:12px;display:flex;align-items:center;gap:10px;color:var(--text);}
  .card-title span:first-child { font size:20px; animation:float 3s ease-in-out infinite; }

  /* Date selector */
  .date-selector{display:grid;grid-template-columns:repeat(7,1fr);gap:8px;margin-top:10px}
  .date-day{
    aspect-ratio:1;display:flex;flex-direction:column;align-items:center;justify-content:center;
    background:linear-gradient(135deg, var(--bg-light), rgba(30,41,59,.8));
    border:2px solid transparent;border-radius:14px;cursor:pointer;transition:all .3s cubic-bezier(0.4, 0, 0.2, 1);
    font-size:12px;position:relative;overflow:hidden;box-shadow:0 4px 15px rgba(0,0,0,.2);
  }
  .date-day::before{content:'';position:absolute;inset:0;background:linear-gradient(135deg, rgba(255,107,53,.1), rgba(99,102,241,.1));opacity:0;transition:opacity .3s ease;}
  .date-day:hover::before { opacity: 1; }
  .date-day .day-name{ font-size:9px;color:var(--text-secondary);margin-bottom:3px;font-weight:800;text-transform:uppercase;letter-spacing:1px;}
  .date-day .day-num{ font-size:16px;font-weight:900;text-shadow:0 2px 4px rgba(0,0,0,.3); }
  .date-day:hover{ border-color:var(--primary); transform:scale(1.08) translateY(-3px); box-shadow:0 8px 25px rgba(255,107,53,.4); }
  .date-day.selected{
    background:linear-gradient(135deg,var(--primary),var(--accent),var(--secondary));
    background-size:200% 200%;animation: gradientShift 4s ease infinite;border-color:transparent;transform:scale(1.05);
    box-shadow:0 8px 30px rgba(255,107,53,.6), 0 0 20px rgba(251,191,36,.3);
  }
  .date-day.today{ border-color:var(--success); box-shadow:0 0 20px rgba(16,185,129,.4); }
  .date-day.weekend:not(.selected), .date-day.holiday:not(.selected){
    background:linear-gradient(135deg, rgba(220, 38, 38, 0.15), rgba(127, 29, 29, 0.15)); border-color:rgba(220, 38, 38, 0.4);
  }
  /* Triangoli presenza */
  .date-day .corner-flag{
    position:absolute; top:0; right:0; width:0; height:0;
    border-left: 18px solid transparent; border-top: 18px solid transparent; pointer-events:none;
  }
  .date-day.has-pres .corner-flag{ border-top-color: var(--success); }
  .date-day.no-pres  .corner-flag{ border-top-color: var(--danger);  }

  /* >>> BLOCCO altri giorni durante "Ripeti ieri" <<< */
  .date-day.disabled{
    pointer-events: none;
    opacity: .45;
    filter: grayscale(.4);
    cursor: not-allowed;
  }

  .date-actions{display:flex;gap:10px;margin-top:12px;flex-wrap:wrap}
  .chip{
    flex:1;background:var(--bg-light);backdrop-filter:blur(20px);border:2px dashed var(--border);
    border-radius:14px;padding:10px 12px;cursor:pointer;font-size:13px;font-weight:800;color:var(--text-secondary);
    text-align:center;transition:all .3s ease;position:relative;overflow:hidden;min-width:42%;
  }
  .chip::before{content:'';position:absolute;inset:0;background:linear-gradient(135deg, rgba(255,107,53,.1), rgba(99,102,241,.1));opacity:0;transition:opacity .3s ease;}
  .chip:hover{ transform: translateY(-2px); border-color:var(--primary); color:var(--text); box-shadow:0 6px 20px rgba(0,0,0,.3); }
  .chip:hover::before { opacity: 1; }
  .chip.active{ border-style:solid;border-color:var(--danger);color:#fff;background:linear-gradient(135deg,rgba(239,68,68,.3),rgba(127,29,29,.3));box-shadow:0 4px 20px rgba(239,68,68,.4); }

  /* Time slots (piÃ¹ compatti, testo bianco) */
  .time-picker{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-top:10px}
  .time-slot{ position:relative; overflow:hidden; border-radius:16px; border:2px solid var(--border); min-height:180px; padding:16px 12px; background:var(--bg-light); transition:all .3s ease; box-shadow:0 4px 20px rgba(0,0,0,.2); display:flex; flex-direction:column;}
  .time-slot:hover { transform: translateY(-4px); box-shadow:0 8px 30px rgba(0,0,0,.3); border-color:rgba(255,255,255,.3);}
  .slot-bg{ position:absolute; inset:0; opacity:.9; border-radius:14px; z-index:0; transition:opacity .3s ease;}
  .time-slot:hover .slot-bg { opacity:1; }
  .time-slot.morning .slot-bg{ background:linear-gradient(135deg,#3b82f6,#06b6d4,#8b5cf6); background-size:200% 200%; animation: gradientShift 6s ease infinite;}
  .time-slot.afternoon .slot-bg{ background:linear-gradient(135deg,var(--primary),#f59e0b,#ec4899); background-size:200% 200%; animation: gradientShift 6s ease infinite;}
  .slot-inner{ position:relative; z-index:1; display:flex; flex-direction:column; align-items:center; justify-content:center; height:100%; gap:8px;}
  .slot-time{ font-size:16px; font-weight:900; text-align:center; text-shadow:2px 2px 8px rgba(0,0,0,.4); letter-spacing:.5px; color:#fff; }
  .slot-hours{ font-size:12px; font-weight:800; background:rgba(0,0,0,.35); border:2px solid rgba(255,255,255,.3); padding:4px 10px; border-radius:999px; box-shadow:0 4px 15px rgba(0,0,0,.3); transition:all .3s ease; color:#fff; }
  .time-selects{ margin-top:10px; display:flex; align-items:center; justify-content:center; gap:8px; width:100%;}
  .time-selects select{ background:rgba(0,0,0,.3); backdrop-filter:blur(10px); border:none; color:#fff; border-radius:12px; padding:12px 10px; font-size:16px; font-weight:900; outline:none; transition:all .3s ease; cursor:pointer; text-align:center; box-shadow:inset 0 2px 8px rgba(0,0,0,.25); -webkit-appearance: none; -moz-appearance: none; appearance: none; text-align-last: center; flex:1; max-width:70px;}
  .time-separator { font-size:18px; font-weight:900; color:rgba(255,255,255,.8); text-shadow:2px 2px 8px rgba(0,0,0,.4); }

  .total-hours-badge{ margin-top:10px; padding:14px; background:linear-gradient(135deg, var(--card-bg), rgba(99,102,241,.1)); backdrop-filter:blur(20px); border:2px solid var(--border); border-radius:14px; text-align:center; box-shadow:0 4px 20px rgba(0,0,0,.2); transition:all .3s ease;}
  .total-hours-badge .label{ color:var(--text-secondary); font-size:12px; margin-bottom:4px; font-weight:700; letter-spacing:1px; text-transform:uppercase;}
  .total-hours-badge .value{ font-size:28px; font-weight:900; background:linear-gradient(135deg, var(--accent), var(--primary)); -webkit-background-clip:text; -webkit-text-fill-color:transparent; background-clip:text; text-shadow:0 0 20px rgba(251,191,36,.3);}

  .input-group{position:relative;margin-top:12px}
  .input-group input,.input-group textarea,.input-group select{
    width:100%;background:var(--bg-light);border:2px solid var(--border);border-radius:14px;padding:14px 14px 14px 48px;font-size:14px;font-weight:600;color:var(--text);transition:all .3s ease;box-shadow:0 2px 10px rgba(0,0,0,.2);
    -webkit-appearance: none;-moz-appearance: none;appearance: none;
  }
  .input-group select {
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%23ffffff' d='M6 9L1 4h10z'/%3E%3C/svg%3E");
    background-repeat: no-repeat; background-position: right 14px center; padding-right: 40px;
  }
  .input-group select option { background:var(--bg-light); color:var(--text); padding:10px; }
  .input-group textarea{min-height:100px;resize:vertical}

  .btn-group{display:flex;gap:10px;margin-top:14px}
  .btn{
    flex:1;background:linear-gradient(135deg,var(--primary),#ec4899,var(--secondary));
    background-size:200% 200%;animation: gradientShift 5s ease infinite;border:none;border-radius:14px;padding:14px;font-size:15px;font-weight:900;color:#fff;cursor:pointer;
    transition:all .3s cubic-bezier(0.4, 0, 0.2, 1);box-shadow:0 4px 20px rgba(255,107,53,.4);position:relative;overflow:hidden;letter-spacing:.5px;text-shadow:0 2px 4px rgba(0,0,0,.3);
  }
  .btn::before { content: ''; position: absolute; inset: 0; background: linear-gradient(135deg, rgba(255,255,255,.2), transparent); opacity: 0; transition: opacity .3s ease; }
  .btn:hover { transform: translateY(-3px); box-shadow:0 8px 30px rgba(255,107,53,.6); }
  .btn:disabled{ opacity:.5; cursor:not-allowed; transform:none !important; }

  /* Presenze mese */
  .month-toggle{ display:flex; align-items:center; justify-content:space-between; gap:12px; background:linear-gradient(135deg, var(--bg-light), rgba(99,102,241,.1)); backdrop-filter:blur(20px); border:2px dashed var(--border); border-radius:14px; padding:12px 14px; cursor:pointer; transition:all .3s ease; box-shadow:0 2px 10px rgba(0,0,0,.2); }
  .month-title-text{ font-weight:900; font-size:15px; background:linear-gradient(135deg, var(--text), var(--primary)); -webkit-background-clip:text; -webkit-text-fill-color:transparent; background-clip:text; }
  .month-list{ display:none; flex-direction:column; gap:10px; margin-top:12px; }
  .month-list.open{ display:flex; animation: fadeIn .4s ease; }
  .month-item{ display:flex; align-items:center; justify-content:space-between; gap:10px; background:linear-gradient(135deg, var(--bg-light), rgba(30,41,59,.8)); backdrop-filter:blur(20px); border:2px solid var(--border); border-radius:14px; padding:12px 14px; transition:all .3s ease; box-shadow:0 2px 10px rgba(0,0,0,.2); }
  .mi-left{display:flex;align-items:flex-start;gap:12px;flex:1;min-width:0}
  .mi-date{ min-width:52px; text-align:center; font-weight:900; background:linear-gradient(135deg, rgba(99,102,241,.2), rgba(255,107,53,.2)); border:2px solid var(--border); border-radius:12px; padding:6px 8px; font-size:13px; box-shadow:0 2px 10px rgba(0,0,0,.2); }
  .mi-main{display:flex;flex-direction:column;min-width:0;flex:1}
  .mi-cant{ font-weight:800; font-size:13px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; color:var(--text); }
  .mi-lav{ font-size:11px; color:var(--text-secondary); white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
  .mi-right{display:flex;align-items:center;gap:8px}
  .mi-ore{ font-weight:900; font-size:14px; background:linear-gradient(135deg, var(--accent), var(--primary)); -webkit-background-clip:text; -webkit-text-fill-color:transparent; background-clip:text; }

  .badge-missing{ display:inline-block; padding:4px 9px; border-radius:999px; background:rgba(239,68,68,.2); border:2px solid rgba(239,68,68,.4); color:#fecaca; font-weight:900; font-size:10px; text-transform:uppercase; letter-spacing:.5px; box-shadow:0 2px 10px rgba(239,68,68,.3); }
  .badge-future{ display:inline-block; padding:4px 9px; border-radius:999px; background:rgba(148,163,184,.2); border:2px solid rgba(148,163,184,.4); color:#e5e7eb; font-weight:900; font-size:10px; text-transform:uppercase; letter-spacing:.5px; }

  .success-overlay{ position:fixed; inset:0; background:rgba(15,23,42,.97); backdrop-filter:blur(20px); display:none; align-items:center; justify-content:center; z-index:1000; animation:fadeIn .2s ease; }
  .success-overlay.show{display:flex}
  .success-overlay .card { animation:float 2s
