<!DOCTYPE html>
<html lang="it">
<head>
Â  <meta charset="UTF-8" />
Â  <title>Presenze Cantiere</title>
Â  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
Â  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
Â  <style>
Â  Â  body {
Â  Â  Â Â 
Â  Â  Â  font-family: 'Roboto', sans-serif;
Â  Â  Â  background: #f9fafb;
Â  Â  Â  padding: 20px;
Â  Â  Â  margin: 0;
Â  Â  }
Â  Â  .container {
Â  max-width: 500px;
Â  margin: 0 auto;
Â  padding: 0 10px;
}

Â  Â  h2, h3 {
Â  Â  Â  text-align: center;
Â  Â  Â  color: #333;
Â  Â  }
Â  Â  input, select, button {
Â  Â  Â  width: 100%;
Â  Â  Â  padding: 14px;
Â  Â  Â  margin: 10px 0;
Â  Â  Â  font-size: 16px;
Â  Â  Â  border: 1px solid #ccc;
Â  Â  Â  border-radius: 8px;
Â  Â  Â  box-sizing: border-box;
Â  Â  }
Â  Â  button {
Â  Â  Â  background-color: #007BFF;
Â  Â  Â  color: white;
Â  Â  Â  border: none;
Â  Â  Â  cursor: pointer;
Â  Â  Â  font-weight: bold;
Â  Â  Â  transition: 0.3s;
Â  Â  }
Â  Â  button:hover {
Â  Â  Â  background-color: #0056b3;
Â  Â  }
Â  Â  #form {
Â  Â  Â  margin-top: 20px;
Â  Â  }
Â  Â  #benvenuto {
Â  Â  Â  text-align: center;
Â  Â  Â  margin-bottom: 20px;
Â  Â  Â  font-weight: bold;
Â  Â  Â  color: #2c3e50;
Â  Â  Â  font-size: 20px;
Â  Â  }
Â  Â  #btnInvia {
Â  Â  Â  background: linear-gradient(to right, #28a745, #218838);
Â  Â  Â  font-size: 18px;
Â  Â  Â  font-weight: bold;
Â  Â  Â  border-radius: 10px;
Â  Â  Â  box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
Â  Â  }
Â  Â  #btnInvia:hover {
Â  Â  Â  background: linear-gradient(to right, #218838, #1e7e34);
Â  Â  }
Â  Â  .section-label {
Â  Â  Â  font-weight: bold;
Â  Â  Â  color: #555;
Â  Â  Â  margin-top: 15px;
Â  Â  }

#importaBox {
Â  background: #e9fbe9;
Â  padding: 16px;
Â  border-radius: 10px;
Â  margin-top: 10px;
Â  margin-bottom: 10px;
Â  box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
Â  border: 1px solid #b7e4b6;
}

#importaBox h4 {
Â  margin-top: 0;
Â  margin-bottom: 6px;
Â  color: #1e7e34;
Â  font-size: 18px;
Â  font-weight: bold;
}

#importaBox .sottotitolo {
Â  margin: 0 0 12px 0;
Â  font-size: 14px;
Â  color: #444;
}

.importa-riga {
Â  display: flex;
Â  align-items: center;
Â  gap: 12px;
Â  flex-wrap: wrap;
}

#importaBox input[list] {
Â  flex: 1 1 250px;
Â  padding: 12px;
Â  font-size: 16px;
Â  border: 1px solid #ccc;
Â  border-radius: 8px;
Â  background: #fff;

}

Â  Â Â 
Â  Â  #ultimaLavorazione {
Â  Â  Â  background-color: #fff;
Â  Â  Â  padding: 10px;
Â  Â  Â  border: 1px solid #ccc;
Â  Â  Â  border-radius: 5px;
Â  Â  Â  margin: 10px 0;
Â  Â  }
Â  Â  #btnGestione {
Â  Â  Â  background-color: #17a2b8;
Â  Â  Â  border-radius: 10px;
Â  Â  Â  font-weight: bold;
Â  Â  }
Â  Â  ul {
Â  Â  Â  padding-left: 20px;
Â  Â  }
Â  Â  li {
Â  Â  Â  margin-bottom: 6px;
Â  Â  }
Â  Â  #cantiere {
Â  border: 2px solid #007BFF;
Â  background-color: #eef4ff;
Â  font-weight: bold;
Â  color: #0056b3;
}
Â  Â  #btnCantiereAltro {
Â  background-color: #d1d1d1;
Â  color: #333;
Â  font-weight: normal;
}
#btnCantiereAltro:hover {
Â  background-color: #bbb;
}

Â  </style>
</head>
<body>
Â  <div class="container">
<div id="benvenuto">
Â  <div id="messaggioBenvenuto"></div>
</div>

Â  <div id="login">
Â  Â  <h2>ğŸ” Login</h2>
Â  Â  <input type="text" id="user" placeholder="ğŸ”‘ Utente">
Â  Â  <input type="password" id="pass" placeholder="ğŸ”’ Password">
Â  Â  <button onclick="login()">ğŸ”“ Accedi</button>
Â  </div>

Â  <div id="form" style="display:none;">
Â  Â  <h3>ğŸ“… Compila Presenza</h3>
Â  Â  <input type="date" id="data">
Â  Â  <div id="orariContainer">
Â  Â  Â  <label class="section-label">â° Orario Inizio:</label>
Â  Â  Â  <div style="display: flex; gap: 10px;">
Â  Â  Â  Â  <select id="oraInizioOra"></select>
Â  Â  Â  Â  <select id="oraInizioMinuti"></select>
Â  Â  Â  </div>
Â  Â  Â  <label class="section-label">â° Orario Fine:</label>
Â  Â  Â  <div style="display: flex; gap: 10px;">
Â  Â  Â  Â  <select id="oraFineOra"></select>
Â  Â  Â  Â  <select id="oraFineMinuti"></select>
Â  Â  Â  </div>
Â  Â  </div>

Â  Â  <select id="cantiere"></select>

Â  Â  <button id="btnCantiereAltro" onclick="mostraCantiereLibero()">ğŸ  Cantiere non presente</button>
Â  Â  <div id="cantiereLibero" style="display:none;">
Â  Â  Â  <input type="text" id="cantiereAltro" placeholder="ğŸ¢ Inserisci nome cantiere">
Â  Â  </div>


Â  Â  <div id="importaBox">
Â  <h4> ğŸ’…â€‹ Lavorazioni eseguite</h4>
Â  <p class="sottotitolo">ğŸ’¡ Scegli tra le lavorazioni recenti o scrivine una nuova:</p>
Â  <div class="importa-riga">
Â  Â  <input list="suggerimentiLavorazioni" id="lavorazione" placeholder="ğŸ§ â€‹ Lavorazioni e suggerimenti" />
Â  Â  <datalist id="suggerimentiLavorazioni"></datalist>
Â  </div>
</div>



Â  Â  <button onclick="mostraOperai()">ğŸ‘ğŸ¼â€‹ Inserisci dati per altri operai</button>
<div id="multiOperai" style="display:none;">
Â  <p style="margin-bottom: 6px; font-size: 14px; color: #555; background: #fff3cd; border-left: 5px solid #ffc107; padding: 10px; border-radius: 6px;">
Â  Â  âš ï¸ Agli operai selezionati verranno applicate le stesse lavorazioni indicate sopra.
Â  </p>
Â  <label class="section-label">ğŸ‘¥ Seleziona altri operai:</label>

Â  Â  Â  <select id="operaio" multiple size="6" style="margin-top: 10px;"></select>

Â  Â  Â  <div style="margin-top:10px;">
Â  Â  Â  Â  <label class="section-label">â• Oppure inserisci un nuovo operaio:</label>
Â  Â  Â  Â  <input type="text" id="nuovoOperaio" placeholder="ğŸ‘· Inserisci nuovo operaio">
Â  Â  Â  </div>
Â  Â  </div>

Â  Â  <button onclick="mostraModal()" id="btnInvia">ğŸ“„ Invia Presenza</button>
Â  Â  <button id="btnGestione" onclick="window.location.href='gestione.html'">ğŸ“… Vai alla Gestione Cantiere</button>

Â  Â  <div id="ultimi7" style="margin-top:20px;"></div>
Â  </div>

Â  <script>
Â  Â  let utente = "";
Â  Â  let nomeOperaio = "";
Â  Â  let ultimoTestoLavorazione = "";

Â  Â  function login() {
Â  Â  Â  const userInput = document.getElementById("user").value.trim();
Â  Â  Â  const passInput = document.getElementById("pass").value.trim();

Â  Â  Â  fetch("https://opensheet.elk.sh/1glvkWLOpUhdBUmY4j-2DJoXQvY6dnQD_OQkYYCaXXEQ/Utenti")
Â  Â  Â  Â  .then(r => r.json())
Â  Â  Â  Â  .then(data => {
Â  Â  Â  Â  Â  const utenteTrovato = data.find(r => r["User"] === userInput && r["Password"] === passInput);
Â  Â  Â  Â  Â  if (utenteTrovato) {
Â  Â  Â  Â  Â  Â  utente = utenteTrovato["User"];
Â  Â  Â  Â  Â  Â  nomeOperaio = utenteTrovato["Nome"];
Â  Â  Â  Â  Â  Â  const ruolo = utenteTrovato["Ruolo"] || "";
Â  Â  Â  Â  Â  Â  localStorage.setItem("ruolo", ruolo);
Â  Â  Â  Â  Â  Â  document.getElementById("messaggioBenvenuto").innerText = `Benvenuto, ${nomeOperaio}`;
Â  Â  Â  Â  Â  Â  if (ruolo.toLowerCase() !== "amministratore") {
Â  Â  Â  Â  Â  Â  Â  document.getElementById("btnGestione").style.display = "none";
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  document.getElementById("login").style.display = "none";
Â  Â  Â  Â  Â  Â  document.getElementById("form").style.display = "block";
Â  Â  Â  Â  Â  Â  document.getElementById("data").value = new Date().toISOString().split("T")[0];
Â  Â  Â  Â  Â  Â  caricaUltimaLavorazione(utente);
Â  Â  Â  Â  Â  Â  popolaOrari();
Â  Â  Â  Â  Â  Â  caricaCantieri();
Â  Â  Â  Â  Â  Â  caricaOperai();
Â  Â  Â  Â  Â  Â  caricaUltimi7();
Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  alert("Credenziali errate");
Â  Â  Â  Â  Â  }
Â  Â  Â  Â  });
Â  Â  }

Â  Â  function popolaOrari() {
Â  Â  Â  const inizioOra = document.getElementById("oraInizioOra");
Â  Â  Â  const inizioMin = document.getElementById("oraInizioMinuti");
Â  Â  Â  const fineOra = document.getElementById("oraFineOra");
Â  Â  Â  const fineMin = document.getElementById("oraFineMinuti");
Â  Â  Â  for (let h = 6; h <= 20; h++) {
Â  Â  Â  Â  const hh = String(h).padStart(2, "0");
Â  Â  Â  Â  inizioOra.innerHTML += `<option value="${hh}" ${hh=="08"?"selected":""}>${hh}</option>`;
Â  Â  Â  Â  fineOra.innerHTML += `<option value="${hh}" ${hh=="17"?"selected":""}>${hh}</option>`;
Â  Â  Â  }
Â  Â  Â  ["00", "15", "30", "45"].forEach(min => {
Â  Â  Â  Â  inizioMin.innerHTML += `<option value="${min}">${min}</option>`;
Â  Â  Â  Â  fineMin.innerHTML += `<option value="${min}">${min}</option>`;
Â  Â  Â  });
Â  Â  }

Â  Â  function caricaCantieri() {
Â  Â  Â  fetch("https://opensheet.elk.sh/1glvkWLOpUhdBUmY4j-2DJoXQvY6dnQD_OQkYYCaXXEQ/Cantieri")
Â  Â  Â  Â  .then(r => r.json())
Â  Â  Â  Â  .then(data => {
Â  Â  Â  Â  Â  const select = document.getElementById("cantiere");
Â  Â  Â  Â  Â  select.innerHTML = '<option value="">-- Seleziona Cantiere --</option>';
Â  Â  Â  Â  Â  data.forEach(r => {
Â  Â  Â  Â  Â  Â  if (r["Cantiere"]) {
Â  Â  Â  Â  Â  Â  Â  const opt = document.createElement("option");
Â  Â  Â  Â  Â  Â  Â  opt.value = r["Cantiere"];
Â  Â  Â  Â  Â  Â  Â  opt.textContent = r["Cantiere"];
Â  Â  Â  Â  Â  Â  Â  select.appendChild(opt);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  });
Â  Â  Â  Â  });
Â  Â  }

Â  Â  function caricaOperai() {
Â  Â  Â  fetch("https://opensheet.elk.sh/1glvkWLOpUhdBUmY4j-2DJoXQvY6dnQD_OQkYYCaXXEQ/Utenti")
Â  Â  Â  Â  .then(r => r.json())
Â  Â  Â  Â  .then(data => {
Â  Â  Â  Â  Â  const select = document.getElementById("operaio");
Â  Â  Â  Â  Â  select.innerHTML = "";
Â  Â  Â  Â  Â  data.forEach(r => {
Â  Â  Â  Â  Â  Â  if (r["Nome"]) {
Â  Â  Â  Â  Â  Â  Â  const opt = document.createElement("option");
Â  Â  Â  Â  Â  Â  Â  opt.value = r["Nome"];
Â  Â  Â  Â  Â  Â  Â  opt.textContent = r["Nome"];
Â  Â  Â  Â  Â  Â  Â  select.appendChild(opt);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  });
Â  Â  Â  Â  });
Â  Â  }

function mostraCantiereLibero() {
Â  const div = document.getElementById("cantiereLibero");
Â  div.style.display = (div.style.display === "block") ? "none" : "block";
}


function mostraOperai() {
Â  const div = document.getElementById("multiOperai");
Â  div.style.display = (div.style.display === "block") ? "none" : "block";
}


Â  Â  function invia() {
Â  Â  Â  const data = document.getElementById("data").value;
Â  Â  Â  const oraInizio = document.getElementById("oraInizioOra").value + ":" + document.getElementById("oraInizioMinuti").value;
Â  Â  Â  const oraFine = document.getElementById("oraFineOra").value + ":" + document.getElementById("oraFineMinuti").value;
Â  Â  Â  const orari = oraInizio + " - " + oraFine;

Â  Â  Â  let cantiereSelezionato = document.getElementById("cantiere").value;
Â  Â  Â  const cantiereAltroInput = document.getElementById("cantiereAltro");
Â  Â  Â  const cantiereAltroValore = cantiereAltroInput.value.trim();
Â  Â  Â  
Â  Â  Â  // Determina il valore finale del cantiere
Â  Â  Â  let cantiere = "";
Â  Â  Â  if (document.getElementById("cantiereLibero").style.display === "block") {
Â  Â  Â  Â  Â  // Se il campo "Cantiere non presente" Ã¨ visibile, usa il suo valore
Â  Â  Â  Â  Â  cantiere = cantiereAltroValore;
Â  Â  Â  } else {
Â  Â  Â  Â  Â  // Altrimenti, usa il valore selezionato dalla dropdown
Â  Â  Â  Â  Â  cantiere = cantiereSelezionato;
Â  Â  Â  }

Â  Â  Â  const lavorazione = document.getElementById("lavorazione").value.trim(); // Aggiunto .trim() per rimuovere spazi
Â  Â  Â  const selezioneOperai = document.getElementById("operaio");
Â  Â  Â  let operaiSelezionati = [];

Â  Â  Â  // --- Validazione dei campi obbligatori ---
Â  Â  Â  if (!data) {
Â  Â  Â  Â  Â  alert("Per favore, inserisci la data.");
Â  Â  Â  Â  Â  return;
Â  Â  Â  }
Â  Â  Â  if (!oraInizio || !oraFine) {
Â  Â  Â  Â  Â  alert("Per favore, seleziona l'orario di inizio e fine.");
Â  Â  Â  Â  Â  return;
Â  Â  Â  }

Â  Â  Â  // Il campo lavorazione Ã¨ sempre obbligatorio
Â  Â  Â  if (!lavorazione) {
Â  Â  Â  Â  Â  alert("Per favore, inserisci la lavorazione.");
Â  Â  Â  Â  Â  return;
Â  Â  Â  }

Â  Â  Â  // Controllo cantiere: Ã¨ obbligatorio a meno che la lavorazione sia "Assente"
Â  Â  Â  if (lavorazione.toLowerCase() !== "assente") {
Â  Â  Â  Â  Â  if (!cantiere) { // Se sia cantiereSelezionato che cantiereAltroValore sono vuoti
Â  Â  Â  Â  Â  Â  Â  alert("Il campo 'Cantiere' Ã¨ obbligatorio, a meno che la lavorazione sia 'Assente'.");
Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  }
Â  Â  Â  } else {
Â  Â  Â  Â  Â  // Se la lavorazione Ã¨ "Assente", assicurati che il cantiere sia vuoto per coerenza
Â  Â  Â  Â  Â  cantiere = ""; 
Â  Â  Â  }

Â  Â  Â  // --- Fine validazione ---

Â  Â  Â  // Logica per determinare gli operai da inviare
Â  Â  Â  if (document.getElementById("multiOperai").style.display === "block") {
Â  Â  Â  Â  Â  operaiSelezionati = Array.from(selezioneOperai.selectedOptions).map(opt => opt.value);
Â  Â  Â  Â  Â  const nuovo = document.getElementById("nuovoOperaio").value.trim();
Â  Â  Â  Â  Â  if (nuovo) operaiSelezionati.push(nuovo);
Â  Â  Â  Â  Â  if (operaiSelezionati.length === 0) {
Â  Â  Â  Â  Â  Â  Â  operaiSelezionati = [nomeOperaio]; 
Â  Â  Â  Â  Â  }
Â  Â  Â  } else {
Â  Â  Â  Â  Â  operaiSelezionati = [nomeOperaio];
Â  Â  Â  }
Â  Â  Â  
Â  Â  Â  // Se la lavorazione Ã¨ "Assente", e l'utente ha comunque messo un cantiere, 
Â  Â  Â  // lo notifichiamo (opzionale, ma utile per chiarezza).
Â  Â  Â  if (lavorazione.toLowerCase() === "assente" && cantiere !== "") {
Â  Â  Â  Â  Â  const confermaAssenteCantiere = confirm("Hai inserito 'Assente' come lavorazione ma hai specificato un cantiere. Il cantiere non verrÃ  salvato. Vuoi continuare?");
Â  Â  Â  Â  Â  if (!confermaAssenteCantiere) {
Â  Â  Â  Â  Â  Â  Â  return; // L'utente ha annullato
Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  cantiere = ""; // Forza il cantiere a essere vuoto se lavorazione Ã¨ "Assente"
Â  Â  Â  }

Â  Â  Â  // Chiamata alla modale di conferma
Â  Â  Â  mostraModal();

Â  Â  Â  // La logica di invio dati vera e propria avverrÃ  in `confermaInvio()` dopo la conferma dell'utente
Â  Â  Â  window.datiDaInviare = { // Memorizzo i dati in una variabile globale temporanea
Â  Â  Â  Â  Â  data,
Â  Â  Â  Â  Â  orari,
Â  Â  Â  Â  Â  cantiere,
Â  Â  Â  Â  Â  lavorazione,
Â  Â  Â  Â  Â  operai: operaiSelezionati,
Â  Â  Â  Â  Â  utente: utente
Â  Â  Â  };
Â  Â  }

// Modifica la funzione confermaInvio per usare i dati salvati
function confermaInvio() {
Â  chiudiModal(); 

Â  const { data, orari, cantiere, lavorazione, operai, utente } = window.datiDaInviare;

Â  operai.forEach(nome => {
Â  Â  Â  const dati = {
Â  Â  Â  Â  Â  data,
Â  Â  Â  Â  Â  orari,
Â  Â  Â  Â  Â  cantiere,
Â  Â  Â  Â  Â  lavorazione,
Â  Â  Â  Â  Â  operaio: nome,
Â  Â  Â  Â  Â  user: utente
Â  Â  Â  };

Â  Â  Â  fetch("https://script.google.com/macros/s/AKfycbybSXuBklZxyoyvo-FvV-UZ280WBygR8wMRTAO97dl8h6_g8-_VjDtBa2uPrVOf2nmI6Q/exec", {
Â  Â  Â  Â  Â  method: "POST",
Â  Â  Â  Â  Â  mode: "no-cors",
Â  Â  Â  Â  Â  body: JSON.stringify(dati),
Â  Â  Â  Â  Â  headers: { "Content-Type": "application/json" }
Â  Â  Â  })
Â  Â  Â  .then(() => {
Â  Â  Â  Â  Â  console.log(`Dati inviati per ${nome}`);
Â  Â  Â  })
Â  Â  Â  .catch(error => {
Â  Â  Â  Â  Â  console.error(`Errore durante l'invio per ${nome}:`, error);
Â  Â  Â  Â  Â  alert(`Si Ã¨ verificato un errore durante l'invio dei dati per ${nome}.`);
Â  Â  Â  });
Â  });

Â  delete window.datiDaInviare;

Â  setTimeout(() => {
Â  Â  Â  caricaUltimi7();
Â  Â  Â  alert("Dati correttamente inseriti.");
Â  Â  Â  document.getElementById("lavorazione").value = "";
Â  Â  Â  document.getElementById("cantiere").selectedIndex = 0;
Â  Â  Â  document.getElementById("cantiereAltro").value = ""; 
Â  Â  Â  document.getElementById("cantiereLibero").style.display = "none"; 
Â  Â  Â  document.getElementById("nuovoOperaio").value = ""; 
Â  Â  Â  document.getElementById("operaio").selectedIndex = -1; 
Â  Â  Â  document.getElementById("multiOperai").style.display = "none"; 
Â  }, 500); 
}

Â  Â  function caricaUltimi7() {
Â  Â  Â  fetch("https://script.google.com/macros/s/AKfycbybSXuBklZxyoyvo-FvV-UZ280WBygR8wMRTAO97dl8h6_g8-_VjDtBa2uPrVOf2nmI6Q/exec?checkPresenze=1&opName=" + encodeURIComponent(nomeOperaio))
Â  Â  Â  Â  .then(r => r.json())
Â  Â  Â  Â  .then(dati => {
Â  Â  Â  Â  Â  let html = "<h4>Ultimi 7 eventi:</h4>";
Â  Â  Â  Â  Â  if (dati.presenze && dati.presenze.length > 0) {
Â  Â  Â  Â  Â  Â  html += "<ul>";
Â  Â  Â  Â  Â  Â  dati.presenze.forEach(r => {
Â  Â  Â  Â  Â  Â  Â  html += `<li>${r.data} | ${r.orari} | ${r.cantiere} | ${r.lavorazione}</li>`;
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  html += "</ul>";
Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  html += "<p>Nessun dato trovato</p>";
Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  document.getElementById("ultimi7").innerHTML = html;
Â  Â  Â  Â  });
Â  Â  }

Â  Â  function caricaUltimaLavorazione(username) {
Â  Â  Â  fetch(`https://script.google.com/macros/s/AKfycbybSXuBklZxyoyvo-FvV-UZ280WBygR8wMRTAO97dl8h6_g8-_VjDtBa2uPrVOf2nmI6Q/exec?getLastWork=1&username=${username}`)
Â  Â  Â  Â  .then(r => r.text())
Â  Â  Â  Â  .then(data => {
Â  Â  Â  Â  Â  const el = document.getElementById("ultimaLavorazione");
Â  Â  Â  Â  Â  if (data && data.trim() !== "") {
Â  Â  Â  Â  Â  Â  el.textContent = data;
Â  Â  Â  Â  Â  Â  ultimoTestoLavorazione = data;
Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  el.textContent = "(Nessuna lavorazione trovata)";
Â  Â  Â  Â  Â  Â  ultimoTestoLavorazione = "";
Â  Â  Â  Â  Â  }
Â  Â  Â  Â  });
Â  Â  }

Â  Â  function importaLavorazione() {
Â  Â  Â  if (ultimoTestoLavorazione) {
Â  Â  Â  Â  document.getElementById("lavorazione").value = ultimoTestoLavorazione;
Â  Â  Â  } else {
Â  Â  Â  Â  alert("Nessuna lavorazione precedente trovata.");
Â  Â  Â  }
Â  Â  }
Â  Â  function mostraModal() {
Â  document.getElementById("modalConferma").style.display = "block";
}

function chiudiModal() {
Â  document.getElementById("modalConferma").style.display = "none";
}

function caricaSuggerimentiLavorazioni() {
Â  fetch("https://script.google.com/macros/s/AKfycbybSXuBklZxyoyvo-FvV-UZ280WBygR8wMRTAO97dl8h6_g8-_VjDtBa2uPrVOf2nmI6Q/exec?lavorazioniRecenti=1")
Â  Â  .then(r => r.json())
Â  Â  .then(data => {
Â  Â  Â  const lista = document.getElementById("suggerimentiLavorazioni");
Â  Â  Â  lista.innerHTML = "";
Â  Â  Â  data.slice(0, 15).forEach(item => {
Â  Â  Â  Â  const opt = document.createElement("option");
Â  Â  Â  Â  opt.value = item;
Â  Â  Â  Â  lista.appendChild(opt);
Â  Â  Â  });
Â  Â  });
}
window.addEventListener("DOMContentLoaded", () => {
Â  caricaSuggerimentiLavorazioni();
});

Â  </script>
<footer style="text-align:center; font-size: 12px; color: #999; margin-top: 40px;">
Â  Â© 2025 Davide Ferrarini â€” Tutti i diritti riservati
</footer>

Â  Â  </div> Â  <div id="modalConferma" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background-color:rgba(0,0,0,0.4); z-index:9999;">
Â  <div style="background:white; max-width:400px; margin:100px auto; padding:20px; border-radius:10px; text-align:center;">
Â  Â  <p style="font-size:18px;">Vuoi confermare l'invio della presenza?</p>
Â  Â  <button onclick="confermaInvio()" style="background-color:#28a745; color:white; padding:10px 20px; margin:10px; border:none; border-radius:6px;">âœ… Conferma</button>
Â  Â  <button onclick="chiudiModal()" style="background-color:#ccc; padding:10px 20px; border:none; border-radius:6px;">âŒ Annulla</button>
Â  </div>
</div>

</body>
</html>
